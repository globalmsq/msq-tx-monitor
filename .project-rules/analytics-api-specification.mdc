---
description: Analytics API ìŠ¤í™ ë° ë…ë¦½ì„± ê°€ì´ë“œ - Volume APIì™€ Realtime/Top APIsì˜ ëª…í™•í•œ êµ¬ë¶„
globs: "apps/tx-api/src/**/*.ts"
alwaysApply: false
---

# Analytics API Specification & Independence Guide

## ğŸ¯ ëª©ì 

ì´ ë¬¸ì„œëŠ” Analytics APIì˜ ëª…í™•í•œ ìŠ¤í™ê³¼ ê° APIì˜ ë…ë¦½ì„±ì„ ì •ì˜í•©ë‹ˆë‹¤.
**Volume API ìˆ˜ì • ì‹œ Realtime/Top APIsê°€ í•¨ê»˜ ìˆ˜ì •ë˜ëŠ” ì‹¤ìˆ˜ë¥¼ ë°©ì§€**í•˜ê¸° ìœ„í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“Š API ë¶„ë¥˜

### 1. Time-Series APIs (ì‹œê³„ì—´ ë°ì´í„°)

**í¬í•¨ API:**
- `/analytics/volume/minutes` - ë¶„ ë‹¨ìœ„ ë³¼ë¥¨ ë°ì´í„°
- `/analytics/volume/hourly` - ì‹œê°„ ë‹¨ìœ„ ë³¼ë¥¨ ë°ì´í„°
- `/analytics/volume/daily` - ì¼ ë‹¨ìœ„ ë³¼ë¥¨ ë°ì´í„°
- `/analytics/volume/weekly` - ì£¼ ë‹¨ìœ„ ë³¼ë¥¨ ë°ì´í„°
- `/analytics/volume/monthly` - ì›” ë‹¨ìœ„ ë³¼ë¥¨ ë°ì´í„°
- `/analytics/anomalies/timeseries/minutes` - ë¶„ ë‹¨ìœ„ ì´ìƒ ê±°ë˜ ë°ì´í„°
- `/analytics/anomalies/timeseries/hourly` - ì‹œê°„ ë‹¨ìœ„ ì´ìƒ ê±°ë˜ ë°ì´í„°
- `/analytics/anomalies/timeseries/daily` - ì¼ ë‹¨ìœ„ ì´ìƒ ê±°ë˜ ë°ì´í„°
- `/analytics/anomalies/timeseries/weekly` - ì£¼ ë‹¨ìœ„ ì´ìƒ ê±°ë˜ ë°ì´í„°

**íŠ¹ì§•:**
- âœ… `limit` íŒŒë¼ë¯¸í„°ë¡œ ë°ì´í„° í¬ì¸íŠ¸ ê°œìˆ˜ ì œì–´
- âœ… ì‹œê°„ ê°„ê²©ë³„ë¡œ ì§‘ê³„ëœ ë°ì´í„° ë°˜í™˜
- âœ… ì°¨íŠ¸ ì‹œê°í™”ìš© ë°ì´í„°
- âœ… ê¸°ê°„ë³„ë¡œ ë‹¤ë¥¸ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš© (minutes/hourly/daily/weekly/monthly)

**Request íŒŒë¼ë¯¸í„°:**
```typescript
{
  token?: string,    // í† í° í•„í„° (MSQ, SUT, KWT, P2UC)
  limit: number      // ë°˜í™˜í•  ë°ì´í„° í¬ì¸íŠ¸ ê°œìˆ˜
}
```

**Response êµ¬ì¡°:**
```typescript
{
  data: [
    {
      datetime: string,        // ISO 8601 format
      tokenSymbol: string,
      totalVolume: string,
      transactionCount: number,
      averageVolume: string
    }
  ],
  timestamp: string,
  cached: boolean
}
```

**ìš©ë„:**
- Volume/Transaction ì°¨íŠ¸ ë Œë”ë§
- íŠ¸ë Œë“œ ë¶„ì„ ì‹œê°í™”
- ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë¶„ì„

---

### 2. Snapshot APIs (ìŠ¤ëƒ…ìƒ· ë°ì´í„°)

**í¬í•¨ API:**
- `/analytics/realtime` - ì‹¤ì‹œê°„ í†µê³„ (ì „ì²´ ê¸°ê°„ ëˆ„ì )
- `/analytics/addresses/top` - ìƒìœ„ ì£¼ì†Œ (ì „ì²´ ê¸°ê°„ ê¸°ì¤€)
- `/analytics/addresses/receivers` - ìƒìœ„ ìˆ˜ì‹  ì£¼ì†Œ (ì „ì²´ ê¸°ê°„ ê¸°ì¤€)
- `/analytics/addresses/senders` - ìƒìœ„ ë°œì‹  ì£¼ì†Œ (ì „ì²´ ê¸°ê°„ ê¸°ì¤€)
- `/analytics/distribution/token` - í† í° ë¶„í¬ (ì „ì²´ ê¸°ê°„)
- `/analytics/network` - ë„¤íŠ¸ì›Œí¬ í†µê³„ (ì „ì²´ ê¸°ê°„)
- `/analytics/anomalies` - ì´ìƒ ê±°ë˜ í†µê³„ (ì „ì²´ ê¸°ê°„)

**íŠ¹ì§•:**
- âŒ ì‹œê°„ ë²”ìœ„ í•„í„°ë§ ì—†ìŒ (ì˜ë„ì  ì„¤ê³„)
- âœ… ì „ì²´ ê¸°ê°„ì˜ ëˆ„ì  ë°ì´í„° ë°˜í™˜
- âœ… ëŒ€ì‹œë³´ë“œ ë©”íŠ¸ë¦­ ì¹´ë“œìš© ë°ì´í„°
- âœ… ìˆœìœ„/ë¶„í¬ í‘œì‹œìš© ë°ì´í„°

**Request íŒŒë¼ë¯¸í„°:**
```typescript
{
  token?: string,        // í† í° í•„í„° (ì„ íƒì )
  limit?: number,        // Top APIsì—ë§Œ í•´ë‹¹
  metric?: string        // Top Addresses APIì—ë§Œ í•´ë‹¹ (volume/transactions)
}
```

**ìš©ë„:**
- ëŒ€ì‹œë³´ë“œ ìƒë‹¨ ë©”íŠ¸ë¦­ ì¹´ë“œ (ì´ ê±°ë˜ìˆ˜, ì´ ë³¼ë¥¨, í™œì„± ì£¼ì†Œ)
- ì—­ëŒ€ ìƒìœ„ ì£¼ì†Œ ìˆœìœ„ í‘œì‹œ
- ì „ì²´ ê¸°ê°„ í†µê³„ ìš”ì•½

---

## ğŸ” ê° APIì˜ ëª…í™•í•œ ìŠ¤í™

### Realtime API

**Endpoint:**
```
GET /analytics/realtime?token=MSQ
```

**ëª©ì :**
- ì „ì²´ ê¸°ê°„ì˜ ì‹¤ì‹œê°„ ëˆ„ì  í†µê³„
- "ì—­ëŒ€" ì´ ê±°ë˜ìˆ˜, ì´ ë³¼ë¥¨ í‘œì‹œ

**Request:**
```typescript
{
  token?: string  // í† í° í•„í„° (ì„ íƒì )
}
```

**Response:**
```typescript
{
  data: {
    totalTransactions: number,        // ì „ì²´ ê¸°ê°„ ì´ ê±°ë˜ìˆ˜
    totalVolume: string,              // ì „ì²´ ê¸°ê°„ ì´ ë³¼ë¥¨
    activeAddresses: number,          // ì „ì²´ ê¸°ê°„ í™œì„± ì£¼ì†Œ ìˆ˜
    transactionsLast24h: number,      // âš ï¸ í˜„ì¬ëŠ” ì „ì²´ì™€ ë™ì¼ (ìˆ˜ì • í•„ìš”)
    volumeLast24h: string,            // âš ï¸ í˜„ì¬ëŠ” ì „ì²´ì™€ ë™ì¼ (ìˆ˜ì • í•„ìš”)
    activeTokens: number,
    tokenStats: [
      {
        tokenSymbol: string,
        totalVolume: string,
        transactionCount: number,
        uniqueAddresses24h: number,
        volume24h: string
      }
    ]
  },
  timestamp: string,
  cached: boolean
}
```

**ì‹œê°„ í•„í„°ë§:**
- âŒ **ì—†ìŒ** (ì˜ë„ì  ì„¤ê³„)
- SQL WHERE ì ˆì— timestamp ì¡°ê±´ ì—†ìŒ
- ì „ì²´ transactions í…Œì´ë¸” ì§‘ê³„

**Service êµ¬í˜„:**
```sql
-- apps/tx-api/src/services/analytics.service.ts:124-131
SELECT COUNT(*), SUM(value), COUNT(DISTINCT fromAddress) + COUNT(DISTINCT toAddress)
FROM transactions
WHERE tokenSymbol = 'MSQ'  -- ì‹œê°„ í•„í„°ë§ ì—†ìŒ!
```

**Frontend ì‚¬ìš©:**
```typescript
// apps/tx-dashboard/src/pages/Analytics.tsx:395
fetch(`${API_BASE_URL}/analytics/realtime?token=${token}`)
```

**ìš©ë„:**
- Analytics í˜ì´ì§€ ìƒë‹¨ ë©”íŠ¸ë¦­ ì¹´ë“œ
- "ì´ ê±°ë˜ìˆ˜", "ì´ ë³¼ë¥¨", "í™œì„± ì£¼ì†Œ" í‘œì‹œ
- ì‹œê°„ ë²”ìœ„ ì„ íƒê³¼ ë¬´ê´€í•˜ê²Œ ê³ ì • ê°’ í‘œì‹œ

---

### Top Addresses API

**Endpoint:**
```
GET /analytics/addresses/top?metric=volume&limit=5&token=MSQ
```

**ëª©ì :**
- ì „ì²´ ê¸°ê°„ ê¸°ì¤€ ìƒìœ„ ì£¼ì†Œ ìˆœìœ„
- "ì—­ëŒ€ Top ì£¼ì†Œ" í‘œì‹œ

**Request:**
```typescript
{
  metric: 'volume' | 'transactions',  // ìˆœìœ„ ê¸°ì¤€
  limit: number,                      // 1-100
  token?: string                      // í† í° í•„í„° (ì„ íƒì )
}
```

**Response:**
```typescript
{
  data: [
    {
      rank: number,
      address: string,
      totalVolume: string,          // ì „ì²´ ê¸°ê°„ ëˆ„ì 
      totalReceived: string,        // ì „ì²´ ê¸°ê°„ ëˆ„ì 
      totalSent: string,            // ì „ì²´ ê¸°ê°„ ëˆ„ì 
      transactionCount: number,     // ì „ì²´ ê¸°ê°„ ëˆ„ì 
      uniqueInteractions: number,
      metric: string
    }
  ],
  timestamp: string,
  cached: boolean
}
```

**ì‹œê°„ í•„í„°ë§:**
- âŒ **ì—†ìŒ** (ì˜ë„ì  ì„¤ê³„)
- ì „ì²´ ê¸°ê°„ ë°ì´í„° ê¸°ì¤€ ìˆœìœ„

**Service êµ¬í˜„:**
```sql
-- apps/tx-api/src/services/analytics.service.ts:281-318
SELECT address, SUM(totalSent), SUM(totalReceived), ...
FROM (
  SELECT fromAddress, SUM(value), COUNT(*)
  FROM transactions
  WHERE tokenSymbol = 'MSQ'  -- ì‹œê°„ í•„í„°ë§ ì—†ìŒ!
  GROUP BY fromAddress
  UNION ALL
  SELECT toAddress, SUM(value), COUNT(*)
  FROM transactions
  WHERE tokenSymbol = 'MSQ'  -- ì‹œê°„ í•„í„°ë§ ì—†ìŒ!
  GROUP BY toAddress
)
GROUP BY address
ORDER BY ... LIMIT 5
```

**Frontend ì‚¬ìš©:**
```typescript
// apps/tx-dashboard/src/pages/Analytics.tsx:476-489
fetch(`${API_BASE_URL}/analytics/addresses/top?metric=volume&limit=5&token=${token}`)
```

**ìš©ë„:**
- "Top Addresses by Volume" ì„¹ì…˜
- ì—­ëŒ€ ìƒìœ„ 5ê°œ ì£¼ì†Œ í‘œì‹œ
- ì‹œê°„ ë²”ìœ„ ì„ íƒê³¼ ë¬´ê´€í•˜ê²Œ ê³ ì • ìˆœìœ„ í‘œì‹œ

---

### Top Receivers API

**Endpoint:**
```
GET /analytics/addresses/receivers?limit=5&token=MSQ
```

**ëª©ì :**
- ì „ì²´ ê¸°ê°„ ê¸°ì¤€ ìˆ˜ì‹  ê±°ë˜ ë§ì€ ì£¼ì†Œ ìˆœìœ„

**Request:**
```typescript
{
  limit: number,      // 1-100
  token?: string      // í† í° í•„í„° (ì„ íƒì )
}
```

**Response:**
```typescript
{
  data: [
    {
      rank: number,
      address: string,
      totalVolume: string,
      transactionCount: number,  // ìˆ˜ì‹  ê±°ë˜ ìˆ˜
      metric: number
    }
  ],
  timestamp: string,
  cached: boolean
}
```

**âš ï¸ Swagger ë¬¸ì„œ vs ì‹¤ì œ êµ¬í˜„:**
- Swagger: `hours` íŒŒë¼ë¯¸í„° ëª…ì‹œ (lines 356-363)
- ì‹¤ì œ: Controllerì—ì„œ `hours` ë¯¸ì‚¬ìš©
- **ì‹¤ì œ ë™ì‘**: ì „ì²´ ê¸°ê°„ ë°ì´í„° (ì‹œê°„ í•„í„°ë§ ì—†ìŒ)

**Service êµ¬í˜„:**
```sql
-- apps/tx-api/src/services/analytics.service.ts:432-441
SELECT toAddress, COUNT(*), SUM(value)
FROM transactions
WHERE tokenSymbol = 'MSQ'  -- ì‹œê°„ í•„í„°ë§ ì—†ìŒ!
GROUP BY toAddress
ORDER BY transactionCount DESC
LIMIT 5
```

---

### Top Senders API

**Endpoint:**
```
GET /analytics/addresses/senders?limit=5&token=MSQ
```

**ëª©ì :**
- ì „ì²´ ê¸°ê°„ ê¸°ì¤€ ë°œì‹  ê±°ë˜ ë§ì€ ì£¼ì†Œ ìˆœìœ„

**Request:**
```typescript
{
  limit: number,      // 1-100
  token?: string      // í† í° í•„í„° (ì„ íƒì )
}
```

**Response:**
```typescript
{
  data: [
    {
      rank: number,
      address: string,
      totalVolume: string,
      transactionCount: number,  // ë°œì‹  ê±°ë˜ ìˆ˜
      metric: number
    }
  ],
  timestamp: string,
  cached: boolean
}
```

**âš ï¸ Swagger ë¬¸ì„œ vs ì‹¤ì œ êµ¬í˜„:**
- Swagger: `hours` íŒŒë¼ë¯¸í„° ëª…ì‹œ (lines 439-446)
- ì‹¤ì œ: Controllerì—ì„œ `hours` ë¯¸ì‚¬ìš©
- **ì‹¤ì œ ë™ì‘**: ì „ì²´ ê¸°ê°„ ë°ì´í„° (ì‹œê°„ í•„í„°ë§ ì—†ìŒ)

**Service êµ¬í˜„:**
```sql
-- apps/tx-api/src/services/analytics.service.ts:470-479
SELECT fromAddress, COUNT(*), SUM(value)
FROM transactions
WHERE tokenSymbol = 'MSQ'  -- ì‹œê°„ í•„í„°ë§ ì—†ìŒ!
GROUP BY fromAddress
ORDER BY transactionCount DESC
LIMIT 5
```

---

## âš ï¸ CRITICAL: API ë…ë¦½ì„± ê·œì¹™

### ì ˆëŒ€ ì§€ì¼œì•¼ í•  ì›ì¹™

#### 1. Volume API ìˆ˜ì • ì‹œ

```
âœ… ìˆ˜ì • ëŒ€ìƒ:
- /analytics/volume/* ì—”ë“œí¬ì¸íŠ¸
- /analytics/anomalies/timeseries/* ì—”ë“œí¬ì¸íŠ¸

âŒ ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€:
- /analytics/realtime
- /analytics/addresses/top
- /analytics/addresses/receivers
- /analytics/addresses/senders
- /analytics/distribution/token
- /analytics/network
- /analytics/anomalies (timeseries ì œì™¸)
```

**ì´ìœ :**
- Volume APIëŠ” **ì°¨íŠ¸ ì‹œê°í™”ìš© ì‹œê³„ì—´ ë°ì´í„°**
- Realtime/Top APIsëŠ” **ì „ì²´ ê¸°ê°„ ëˆ„ì  ìŠ¤ëƒ…ìƒ· ë°ì´í„°**
- Request íŒŒë¼ë¯¸í„°ê°€ ë‹¤ë¦„ (`limit` vs ì—†ìŒ)
- Response êµ¬ì¡°ê°€ ë‹¤ë¦„ (ë°°ì—´ vs ê°ì²´)
- ì‚¬ìš© ëª©ì ì´ ì™„ì „íˆ ë‹¤ë¦„

#### 2. Realtime/Top APIs ìˆ˜ì • ì‹œ

```
âœ… ìˆ˜ì • ëŒ€ìƒ:
- /analytics/realtime
- /analytics/addresses/*
- /analytics/distribution/token
- /analytics/network
- /analytics/anomalies (statsë§Œ)

âŒ ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€:
- /analytics/volume/*
- /analytics/anomalies/timeseries/*
```

**ì´ìœ :**
- Realtime/Top APIsëŠ” **ì „ì²´ ê¸°ê°„ ëˆ„ì  ë°ì´í„°**
- Volume APIsëŠ” **ì‹œê°„ë³„ ë¶„í•  ë°ì´í„°**
- ë…ë¦½ì ì¸ ìºì‹± ì „ëµ
- ë…ë¦½ì ì¸ ì„±ëŠ¥ ìµœì í™” í•„ìš”

---

## ğŸ§ª Frontend ë™ì‘ ì„¤ëª…

### Analytics.tsxì˜ ì˜ë„ëœ ë™ì‘

**ì‹œê°„ ë²”ìœ„ ì„ íƒ ë²„íŠ¼ (`1h`, `24h`, `7d`, `30d`, `3m`, `6m`, `1y`, `all`):**

```typescript
// apps/tx-dashboard/src/pages/Analytics.tsx:1028-1065

const handleTimeRangeChange = (range: TimeRange) => {
  setTimeRange(range);
  // fetchAnalyticsDataê°€ ìë™ í˜¸ì¶œë¨
};
```

**ì‹œê°„ ë²”ìœ„ ë³€ê²½ ì‹œ API í˜¸ì¶œ:**

1. **âœ… ë³€ê²½ë˜ëŠ” API (Time-Series):**
   ```typescript
   // Volume API - limit íŒŒë¼ë¯¸í„°ë¡œ ê¸°ê°„ ì œì–´
   fetch(`${volumeEndpoint}?limit=${limit}&token=${token}`)

   // Anomaly Timeseries API - limit íŒŒë¼ë¯¸í„°ë¡œ ê¸°ê°„ ì œì–´
   fetch(`${anomalyEndpoint}?limit=${limit}&token=${token}`)
   ```

2. **âŒ ë³€ê²½ë˜ì§€ ì•ŠëŠ” API (Snapshot) - ì˜ë„ëœ ë™ì‘:**
   ```typescript
   // Realtime API - ì „ì²´ ê¸°ê°„ ê³ ì •
   fetch(`${API_BASE_URL}/analytics/realtime?token=${token}`)

   // Top Addresses API - ì „ì²´ ê¸°ê°„ ê³ ì •
   fetch(`${API_BASE_URL}/analytics/addresses/top?metric=volume&limit=5&token=${token}`)

   // Top Receivers API - ì „ì²´ ê¸°ê°„ ê³ ì •
   fetch(`${API_BASE_URL}/analytics/addresses/receivers?limit=5&token=${token}`)

   // Top Senders API - ì „ì²´ ê¸°ê°„ ê³ ì •
   fetch(`${API_BASE_URL}/analytics/addresses/senders?limit=5&token=${token}`)
   ```

**ì´ëŠ” ë²„ê·¸ê°€ ì•„ë‹Œ ì˜ë„ëœ ì„¤ê³„ì…ë‹ˆë‹¤!**

### UI í‘œì‹œ íŒ¨í„´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‹œê°„ ë²”ìœ„: [1h] 24h 7d 30d ...         â”‚ â† ì„ íƒ ê°€ëŠ¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ì´ ê±°ë˜ìˆ˜: 1,234,567  (ì „ì²´ ê¸°ê°„)      â”‚ â† ì‹œê°„ ë²”ìœ„ ë¬´ê´€
â”‚  ì´ ë³¼ë¥¨: 9.87M MSQ    (ì „ì²´ ê¸°ê°„)      â”‚ â† ì‹œê°„ ë²”ìœ„ ë¬´ê´€
â”‚  í™œì„± ì£¼ì†Œ: 45,678     (ì „ì²´ ê¸°ê°„)      â”‚ â† ì‹œê°„ ë²”ìœ„ ë¬´ê´€
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ğŸ“Š Volume ì°¨íŠ¸ (ì„ íƒí•œ ê¸°ê°„)           â”‚ â† ì‹œê°„ ë²”ìœ„ ë°˜ì˜
â”‚  [ì°¨íŠ¸ ë°ì´í„°: ìµœê·¼ 1ì‹œê°„]               â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ğŸ† Top Addresses (ì „ì²´ ê¸°ê°„)           â”‚ â† ì‹œê°„ ë²”ìœ„ ë¬´ê´€
â”‚  1. 0x1234... - 1.5M MSQ                â”‚
â”‚  2. 0x5678... - 1.2M MSQ                â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ìˆ˜ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

### Volume API ìˆ˜ì • ì‹œ

- [ ] Volume APIë§Œ ìˆ˜ì • (`apps/tx-api/src/services/analytics.service.ts`)
  - [ ] `getHourlyVolume()`
  - [ ] `getMinuteVolumeStats()`
  - [ ] `getDailyVolumeStats()`
  - [ ] `getWeeklyVolumeStats()`
  - [ ] `getMonthlyVolumeStats()`
- [ ] Anomaly Timeseries API í•¨ê»˜ ê²€í† 
  - [ ] `getAnomalyTimeSeries()`
  - [ ] `getAnomalyTimeSeriesMinutes()`
  - [ ] `getAnomalyTimeSeriesDaily()`
  - [ ] `getAnomalyTimeSeriesWeekly()`
- [ ] **Realtime APIëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ** â›”
- [ ] **Top APIsëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ** â›”
- [ ] Request íŒŒë¼ë¯¸í„° ì¼ê´€ì„± í™•ì¸ (`limit` íŒŒë¼ë¯¸í„° ì‚¬ìš©)
- [ ] Response êµ¬ì¡° í†µì¼ì„± í™•ì¸
  - [ ] `datetime: string` (ISO 8601)
  - [ ] `tokenSymbol: string`
  - [ ] `totalVolume: string`
  - [ ] `transactionCount: number`
  - [ ] `averageVolume: string`
- [ ] Frontend í˜¸ì¶œ ì½”ë“œ ê²€í†  (`Analytics.tsx`)
- [ ] SQL ì¿¼ë¦¬ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ìºì‹± ì „ëµ ì—…ë°ì´íŠ¸

### Realtime/Top APIs ìˆ˜ì • ì‹œ

- [ ] Realtime/Top APIsë§Œ ìˆ˜ì •
  - [ ] `getRealtimeStats()`
  - [ ] `getTopAddresses()`
  - [ ] `getTopReceivers()`
  - [ ] `getTopSenders()`
- [ ] **Volume APIì™€ ë…ë¦½ì ìœ¼ë¡œ ìˆ˜ì •** â›”
- [ ] **ì‹œê°„ í•„í„°ë§ ë¡œì§ ì¶”ê°€ ê¸ˆì§€** (í˜„ì¬ ì„¤ê³„ ìœ ì§€)
- [ ] ì „ì²´ ê¸°ê°„ ì§‘ê³„ ë¡œì§ ìœ ì§€
- [ ] Swagger ë¬¸ì„œ ì •í™•ì„± í™•ì¸
  - [ ] Top Receivers/Sendersì˜ ë¶ˆí•„ìš”í•œ `hours` íŒŒë¼ë¯¸í„° ì œê±°
- [ ] ìºì‹± ì „ëµ ê³ ë ¤ (ì „ì²´ ë°ì´í„° ìºì‹±)
- [ ] ì„±ëŠ¥ ìµœì í™” (ì¸ë±ìŠ¤, ì¿¼ë¦¬ ìµœì í™”)

---

## ğŸ”§ ì•Œë ¤ì§„ ë¬¸ì œì 

### 1. Swagger ë¬¸ì„œ ë¶ˆì¼ì¹˜

**ë¬¸ì œ:**
- Top Receivers/Senders APIì˜ Swagger ë¬¸ì„œì— `hours` íŒŒë¼ë¯¸í„° ëª…ì‹œ
- ì‹¤ì œ Controller/Serviceì—ì„œëŠ” `hours` íŒŒë¼ë¯¸í„° ë¯¸ì‚¬ìš©

**ìœ„ì¹˜:**
```typescript
// apps/tx-api/src/controllers/analytics.controller.ts:356-363
// apps/tx-api/src/controllers/analytics.controller.ts:439-446
@swagger
parameters:
  - name: hours
    in: query
    description: Number of hours to look back
```

**í•´ê²° ë°©ë²•:**
- Swagger ë¬¸ì„œì—ì„œ `hours` íŒŒë¼ë¯¸í„° ì œê±°
- ë˜ëŠ” ì‹¤ì œ êµ¬í˜„ì— `hours` íŒŒë¼ë¯¸í„° ì¶”ê°€ (ì„¤ê³„ ë³€ê²½ í•„ìš”)

### 2. Realtime APIì˜ í˜¼ë€ìŠ¤ëŸ¬ìš´ í•„ë“œëª…

**ë¬¸ì œ:**
```typescript
{
  totalTransactions: number,        // ì „ì²´ ê¸°ê°„
  transactionsLast24h: number,      // ì‹¤ì œë¡œëŠ” ì „ì²´ ê¸°ê°„ê³¼ ë™ì¼
  volumeLast24h: string             // ì‹¤ì œë¡œëŠ” ì „ì²´ ê¸°ê°„ê³¼ ë™ì¼
}
```

**í˜„ì¬ êµ¬í˜„:**
```sql
-- ë‘ ì¿¼ë¦¬ê°€ WHERE ì ˆ ë™ì¼ (ì‹œê°„ í•„í„° ì—†ìŒ)
SELECT COUNT(*) FROM transactions WHERE tokenSymbol = 'MSQ'  -- totalTransactions
SELECT COUNT(*) FROM transactions WHERE tokenSymbol = 'MSQ'  -- transactionsLast24h
```

**í•´ê²° ë°©ë²•:**
1. í•„ë“œëª… ë³€ê²½ (Breaking Change)
   - `transactionsLast24h` â†’ `totalTransactions`
   - `volumeLast24h` â†’ `totalVolume`
2. ë˜ëŠ” ì‹¤ì œ 24ì‹œê°„ ë°ì´í„° ì œê³µ (ì„¤ê³„ ë³€ê²½)
   - WHERE ì ˆì— `timestamp >= NOW() - INTERVAL 24 HOUR` ì¶”ê°€

---

## ğŸ¯ í–¥í›„ ê°œì„  ì œì•ˆ

### 1. API ëª…ëª… ê·œì¹™ ê°œì„ 

**í˜„ì¬:**
- `/analytics/realtime` - ì‹¤ì‹œê°„ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ì‹¤ì œë¡œëŠ” ì „ì²´ ê¸°ê°„
- `/analytics/addresses/top` - ìƒìœ„ ì£¼ì†Œì´ì§€ë§Œ ê¸°ê°„ ë¶ˆëª…í™•

**ì œì•ˆ:**
```
/analytics/summary/all-time          // ì „ì²´ ê¸°ê°„ ìš”ì•½
/analytics/addresses/top/all-time    // ì „ì²´ ê¸°ê°„ ìƒìœ„ ì£¼ì†Œ
```

### 2. ì‹œê°„ ë²”ìœ„ ì§€ì› API ì¶”ê°€ (ì„ íƒì )

ë§Œì•½ ì‹œê°„ ë²”ìœ„ë³„ Realtime/Top ë°ì´í„°ê°€ í•„ìš”í•˜ë‹¤ë©´:

```
GET /analytics/realtime?timeRange=24h         // 24ì‹œê°„ í†µê³„
GET /analytics/addresses/top?timeRange=7d     // 7ì¼ê°„ ìƒìœ„ ì£¼ì†Œ
```

**ì£¼ì˜:** ì´ëŠ” í˜„ì¬ ì„¤ê³„ì˜ ê·¼ë³¸ì  ë³€ê²½ì´ë¯€ë¡œ ì‹ ì¤‘íˆ ê²€í†  í•„ìš”

### 3. Responseì— ê¸°ê°„ ì •ë³´ ëª…ì‹œ

```typescript
{
  data: { ... },
  timeRange: "all-time" | "24h" | "7d" | ...,
  aggregationPeriod: {
    start: "2024-01-01T00:00:00Z",
    end: "2024-12-31T23:59:59Z"
  },
  timestamp: "2024-12-31T23:59:59Z"
}
```

---

## ğŸ“š ê´€ë ¨ íŒŒì¼

### Backend
- `apps/tx-api/src/controllers/analytics.controller.ts` - Request ì²˜ë¦¬, íŒŒë¼ë¯¸í„° ê²€ì¦
- `apps/tx-api/src/services/analytics.service.ts` - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, SQL ì¿¼ë¦¬
- `apps/tx-api/src/routes/analytics.routes.ts` - ë¼ìš°íŒ… ì •ì˜

### Frontend
- `apps/tx-dashboard/src/pages/Analytics.tsx` - Analytics í˜ì´ì§€ (lines 300-1459)
  - Line 395: Realtime API í˜¸ì¶œ
  - Line 445: Volume API í˜¸ì¶œ (ì‹œê°„ ë²”ìœ„ ë°˜ì˜)
  - Line 476: Top Addresses API í˜¸ì¶œ
  - Line 492: Top Receivers API í˜¸ì¶œ
  - Line 509: Top Senders API í˜¸ì¶œ

### Documentation
- `.project-rules/analytics-api-specification.mdc` - ì´ ë¬¸ì„œ

---

## ğŸ” ë””ë²„ê¹… ê°€ì´ë“œ

### Volume APIê°€ ë³€ê²½ë˜ì—ˆëŠ”ë° Top APIsê°€ í•¨ê»˜ ìˆ˜ì •ëœ ê²½ìš°

1. **ë³€ê²½ ì‚¬í•­ í™•ì¸:**
   ```bash
   git diff apps/tx-api/src/services/analytics.service.ts
   ```

2. **ì²´í¬ë¦¬ìŠ¤íŠ¸:**
   - [ ] `getTopAddresses()` ë©”ì„œë“œê°€ ìˆ˜ì •ë˜ì—ˆëŠ”ê°€?
   - [ ] `getTopReceivers()` ë©”ì„œë“œê°€ ìˆ˜ì •ë˜ì—ˆëŠ”ê°€?
   - [ ] `getTopSenders()` ë©”ì„œë“œê°€ ìˆ˜ì •ë˜ì—ˆëŠ”ê°€?
   - [ ] `getRealtimeStats()` ë©”ì„œë“œê°€ ìˆ˜ì •ë˜ì—ˆëŠ”ê°€?

3. **ë˜ëŒë¦¬ê¸°:**
   ```bash
   # Volume API ë³€ê²½ë§Œ ìœ ì§€, ë‚˜ë¨¸ì§€ ë˜ëŒë¦¬ê¸°
   git checkout HEAD -- apps/tx-api/src/services/analytics.service.ts
   # Volume API ë©”ì„œë“œë§Œ ì„ íƒì ìœ¼ë¡œ ë‹¤ì‹œ ì ìš©
   ```

### API ì‘ë‹µì´ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ê²½ìš°

1. **API ë¶„ë¥˜ í™•ì¸:**
   - Time-Series APIì¸ê°€? â†’ `limit` íŒŒë¼ë¯¸í„° í™•ì¸
   - Snapshot APIì¸ê°€? â†’ ì‹œê°„ í•„í„°ë§ ì—†ìŒ í™•ì¸

2. **SQL ì¿¼ë¦¬ í™•ì¸:**
   ```sql
   -- Time-Series: datetime GROUP BY ìˆì–´ì•¼ í•¨
   SELECT datetime, SUM(value), COUNT(*)
   FROM transactions
   GROUP BY datetime
   ORDER BY datetime DESC
   LIMIT ?

   -- Snapshot: ì „ì²´ ì§‘ê³„
   SELECT SUM(value), COUNT(*)
   FROM transactions
   WHERE tokenSymbol = ?
   ```

3. **Frontend í˜¸ì¶œ í™•ì¸:**
   ```typescript
   // Time-Series: limit íŒŒë¼ë¯¸í„° í•„ìˆ˜
   fetch(`/analytics/volume/hourly?limit=${limit}&token=${token}`)

   // Snapshot: limit íŒŒë¼ë¯¸í„° ì—†ìŒ ë˜ëŠ” ì„ íƒì 
   fetch(`/analytics/realtime?token=${token}`)
   ```

---

## âœ… ìš”ì•½

### Time-Series APIs (ì°¨íŠ¸ìš©)
- âœ… `limit` íŒŒë¼ë¯¸í„°ë¡œ ë°ì´í„° í¬ì¸íŠ¸ ì œì–´
- âœ… ì‹œê°„ ê°„ê²©ë³„ ë°°ì—´ ë°˜í™˜
- âœ… Volume, Anomaly Timeseries APIs
- âœ… **UI ê¸°ê°„ ì„ íƒê³¼ ì—°ë™**

### Snapshot APIs (ë©”íŠ¸ë¦­ ì¹´ë“œìš©)
- âŒ ì‹œê°„ í•„í„°ë§ ì—†ìŒ (ì˜ë„ì )
- âœ… ì „ì²´ ê¸°ê°„ ëˆ„ì  ë°ì´í„°
- âœ… Realtime, Top Addresses/Receivers/Senders APIs
- âœ… **UI ê¸°ê°„ ì„ íƒê³¼ ë¬´ê´€**

### ë…ë¦½ì„± ì›ì¹™
- â›” Volume API ìˆ˜ì • ì‹œ Realtime/Top APIs ê±´ë“œë¦¬ì§€ ë§ ê²ƒ
- â›” Realtime/Top APIs ìˆ˜ì • ì‹œ Volume APIs ê±´ë“œë¦¬ì§€ ë§ ê²ƒ
- âœ… ê° APIëŠ” ë…ë¦½ì ì¸ ëª©ì ê³¼ ìŠ¤í™ì„ ê°€ì§
- âœ… Request/Response êµ¬ì¡°ê°€ ê·¼ë³¸ì ìœ¼ë¡œ ë‹¤ë¦„

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2025-10-19
**ì‘ì„±ì:** Claude Code
**ë²„ì „:** 1.0.0
